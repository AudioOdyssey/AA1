{% extends "template.html" %}
{% block content %}
<script src="{{ url_for('static', filename='js/story/run.js') }}"></script>
<!--NONE OF THIS NEEDS TO BE SAVABLE PER MIGUEL basically just a text version of the app but doesnt
need to be nearly as clean/advanced. Do we want to make this like treeview where it replaces itself?-->

<button onclick="start_over('{{story.story_id}}')" class="btn btn-light">Back to Start</button>
<a href="/story/update?story_id={{story.story_id}}" class="btn btn-light">Back to Main Story Page</a>
<a class="btn btn-primary" style="float:right"
    href="/story/location/indiv?story_id={{story.story_id}}&location_id={{location.location_id}}">Edit Location</a>

<h1>Running {{story.story_title|e}}</h1>
<br>
<h3>Inventory:</h3>
{%for itm in inv%}
<div style="margin:0.5rem; border: solid grey 1px; padding: 0.25rem; background: white">{{itm.obj_name|e}}</div>
{%else%}
<div style="margin:0.5rem; border: solid grey 1px; padding: 0.25rem; background: white">Nothing!</div>
{%endfor%}
<h3>Triggered Events:</h3>
{%for event in evts%}
<div style="margin:0.5rem; border: solid grey 1px; padding: 0.25rem; background: white">{{event.event_name|e}}</div>
{%else%}
<div style="margin:0.5rem; border: solid grey 1px; padding: 0.25rem; background: white">Nothing!</div>
{%endfor%}

<h2>At {{location.location_name|e}}</h2>

<hr>
<h3>{{location.original_description|e}}</h3>
<!--I think printing 
    all of these is acceptable maybe we could hide the not relevant ones if we can track the info?-->
<p>(if already visited: {{location.short_description|e}})</p>
{% if location.location_event_id|int!=0 %}
<p>(if {{location.event_name|e}} has been triggered:{{location.post_event_description|e}} )</p>
{%endif%}
<hr>
<!--for objects at this location (brian idk how to keep track of that)-->
<!--print their names and have a pick up option-->
{%for obj in objects%}
<a onclick="addItem({{obj.obj_id}})" class="btn btn-light" {%if not obj.can_pickup_obj%}disabled{%endif%}>Pick Up
    <i>{{obj.obj_name}}</i></a>
{%endfor%}
<p>Would you like to ...</p>

<section class="row">
    {%for dec in decisions%}
    <a href="#" onclick="dec_clicked({{story.story_id}},{{dec.decision_id}},{{dec.transition}},{{dec.transition_loc_id}},{{dec.can_occur_once}},{{dec.cause_event}},{{dec.effect_event_id}})"
        class="col-sm-4 storycard">
        <h3>{{dec.decision_name|e}}</h3>
        <hr>
        <h5>Transitions to
            <i>{%if dec.transition%}{{StoryLocation.get(story.story_id, dec.transition_loc_id).location_name}}{%else%}Nowhere{%endif%}</i>
        </h5>
        {%if dec.hidden%}
        {%if dec.show_event_id!=0%}
        {%if dec.show_event_id in evts%}
        <h6>Was hidden by Event {{StoryEvent.get(story.story_id, dec.show_event_id).event_name|e}}, now revealed</h6>
        {%else%}
        <h6>Hidden by Event {{StoryEvent.get(story.story_id, dec.show_event_id).event_name|e}}</h6>
        {%endif%}
        {%elif dec.show_object_id!=0%}
        {%if dec.show_object_id in inv%}
        <h6>Was hidden by Object {{StoryObject.get(story.story_id, dec.show_object_id).obj_name|e}}, now revealed</h6>
        {%else%}
        <h6>Hidden by Object {{StoryObject.get(story.story_id, dec.show_object_id).obj_name|e}}</h6>
        {%endif%}
        {%endif%}
        {%endif%}

        {%if dec.locked%}
        {%if dec.unlock_event_id!=0%}
        {%if dec.unlock_event_id in inv%}
        <h6>Was locked by Event {{StoryEvent.get(story.story_id, dec.unlock_event_id).event_name|e}}, now revealed</h6>
        {%else%}
        <h6>Locked by Event {{StoryEvent.get(story.story_id, dec.unlock_event_id).event_name|e}}</h6>
        {%endif%}
        {%elif dec.unlock_object_id!=0%}
        {%if dec.unlock_object_id in evts%}
        <h6>Was locked by Object {{StoryObject.get(story.story_id, dec.unlock_object_id).obj_name|e}}, now unlocked</h6>
        {%else%}
        <h6>Locked by Object {{StoryObject.get(story.story_id, dec.unlock_object_id).obj_name|e}}</h6>
        {%endif%}
        {%endif%}
        {%endif%}

        {%if dec.cause_event%}
        <h6>Causes Event {{StoryEvent.get(story.story_id, dec.effect_event_id).event_name|e}}</h6>
        {%endif%}

        {%if dec.is_locked_by_event_id!=0%}
        {%if dec.is_locked_by_event_id in evts%}
        <h6>Now locked by Event {{StoryEvent.get(story.story_id, dec.is_locked_by_event_id).event_name|e}}</h6>
        {%else%}
        <h6>Gets locked by Event {{StoryEvent.get(story.story_id, dec.is_locked_by_event_id).event_name|e}}</h6>
        {%endif%}
        {%endif%}

        {%if dec.can_occur_once%}
        {%if dec.decision_id in triggered%}
        <h6 style="color: red">Decision can only be triggered once, and has already been triggered!</h6>
        {%else%}
        <h6>Decision can only be triggered once</h6>
        {%endif%}
        {%endif%}

        <p>{{dec.decision_description|e}}</p>
    </a>
    {%endfor%}
</section>

<!--
if transition
    Transitions to transitionid
    click: push back to cookie
    click: transition to transitionid
if hidden
    if hideobj != 0
        if hideobj not in inv
            Hidden by object hideobj
    if hideevt != 0
        if hideevt not in evts
            Hidden by event hideevt
if locked
    if lockobj != 0
        if lockobj not in inv
            Locked by object lockobj
    if lockevt != 0
        if lockevt not in evts
            Locked by event lockevt
if triggers
    Triggers Event triggerevt
    click: triggerevt
if locker != 0
    if locker in events
        Locked by Event locker
if once
    if dec not in cookie
        Can be triggered once
        click: add to cookie
    else
        Has been triggered, can't be again
-->

<br>
<hr>

<button onclick="start_over('{{story.story_id}}')" class="btn btn-light">Back to Start</button>
<a href="/story/update?story_id={{story.story_id}}" class="btn btn-light">Back to Main Story Page</a>
<a class="btn btn-primary" style="float:right"
    href="/story/location/indiv?story_id={{story.story_id}}&location_id={{location.location_id}}">Edit Location</a>

{% endblock %}